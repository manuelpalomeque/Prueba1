<!DOCTYPE html>
<html>
<head>
    <title>Integration Example</title>
</head>
<body>
    <script>
        import OmnichannelChatSDK from '@microsoft/omnichannel-chat-sdk';
        
        const signInIds = [];
window.Microsoft.Omnichannel.LiveChatWidget.SDK.setBotAuthTokenProvider(async (botTokenUrl, callback) => {
  const urlSearchParams = new URLSearchParams(botTokenUrl);
  const signInId = urlSearchParams.get("state");

  if (signInIds.includes(signInId)) { // Ignore authenticated sign-in cards
    callback({show: false});  // Hide card
    return;
  }

  signInIds.push(signInId);

  const authUrl = ""; // Customer's Authentication API
  const authResponse = await fetch(authUrl, method: "POST"});
  const {token} = authResponse;  // Customer's Auth Token

  const data = {
    token: "token"
  };

  const payload = {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  };

  try {
    const botAuthResponse = await fetch(botTokenUrl, payload); // Posts Auth Token to Bot directly
    
    // Sign in through Bot is successful
    if (botAuthResponse.status === 200) {
      signInIds.push(signInId); // Track authenticated sign-in card
      callback({show: false}); // Hide card
    }

    if (botAuthResponse.status === 404 || botAuthResponse.status == 202) {
      callback({show: false}); // Hide card
      return;
    } else {
      // Other condition handling    
    }

    return;
  } catch (error) {
  
  }

  callback({show: true});  // Show sign-in card by default
});
    </script>
    <script 
        id="Microsoft_Omnichannel_LCWidget" 
        src="https://oc-cdn-public.azureedge.net/livechatwidget/scripts/LiveChatBootstrapper.js" 
        data-app-id="70ec806d-33b3-433c-ae08-d1154e8f5d54" 
        data-lcw-version="prod" 
        data-org-id="e01710f5-3028-427e-a334-c25d52a4fb2f" 
        data-org-url="https://unqe01710f53028427ea334c25d52a4f-crm2.omnichannelengagementhub.com">
    </script>
</body>
</html>
